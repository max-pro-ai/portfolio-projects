# AI ChatBot Assistant (Плагин WordPress)

AI ChatBot Assistant — это плагин WordPress, который добавляет на сайт виджет чата на базе OpenAI. Он сохраняет переписку «пользователь–бот» и, по истечении настраиваемого тайм‑аута неактивности, отправляет историю переписки на e‑mail и (при желании) в Telegram.

Важно: чтобы доставка происходила вовремя, нужен работающий WP‑Cron (системный cron или внешний «пингер»). Плагин ставит задачи на стороне сервера, независимо от браузера.

## Возможности
- Виджет чата с настраиваемым интерфейсом (размер, цвета, шрифты, тексты)
- Интеграция с OpenAI с выбором модели (современные значения по умолчанию)
- Хранение переписки в БД; локальный кэш для удобства просмотра
- Постановка истории в очередь на сервере после тайм‑аута
- Отправка e‑mail через PHP mail() и опционально в Telegram
- Надёжные повторы; очередь удаляется только после успешной доставки

## Как это работает
1) Пользователь отправляет сообщение → плагин сохраняет переписку в БД.
2) Сервер ставит задачу с временем отправки: время последнего сообщения + тайм‑аут.
3) Ежеминутная задача (cron) обрабатывает «созревшие» истории и отправляет их на почту (+ Telegram, если включён).
4) После успешной доставки во все каналы файл очереди удаляется. При ошибке — повторная попытка позже.

Примечание: UI хранит короткую локальную копию переписки для UX, но «истиной» для доставки является серверная очередь.

## Требования
- WordPress 5.8+
- PHP 7.4+
- Включённая исходящая почта для PHP mail()
- (Опционально) Telegram Bot Token и Chat ID
- Активный WP‑Cron (рекомендуется системный cron или внешний «пингер»)

## Установка
1) Загрузите каталог `ai-chatbot-plugin` в `wp-content/plugins/`.
2) Активируйте «AI ChatBot Assistant» на странице Плагины.
3) Зайдите в Настройки → AI ChatBot и укажите:
   - OpenAI API ключ и модель
   - Внешний вид виджета и тексты
   - E‑mail для получателя
   - Тайм‑аут неактивности (мс)
   - Telegram (опционально): токен бота и Chat ID

## Настройка cron (рекомендуется)
- Системный cron (предпочтительно):
  - Ежеминутно: php /path/to/wordpress/wp-cron.php >/dev/null 2>&1
- Или HTTP‑пингер (например, UptimeRobot):
  - Ежеминутно: https://ВАШ_САЙТ/wp-cron.php?doing_wp_cron
- Убедитесь, что в wp-config.php НЕ установлено DISABLE_WP_CRON = true.

## Диагностика
- Истории приходят только после визита на сайт:
  - Скорее всего, не работает WP‑Cron. Настройте системный cron или внешний пингер.
- Письмо не приходит:
  - Проверьте, что хостинг разрешает PHP mail(); проверьте спам; адрес в настройках; посмотрите wp-content/debug.log.
- Telegram не приходит:
  - Проверьте Bot Token и Chat ID; протестируйте из настроек; посмотрите debug.log.

## Документация
- README на английском: README.md
- README українською: README-uk.md
- Архитектура и схема потоков: docs/SCHEMA.md

## Лицензия
Проект предоставляется «как есть» владельцем сайта; добавьте файл лицензии, если планируете публичное распространение.
